@using AzureBlazorCosmosWasm.Data
@using Syncfusion.Blazor;
@using Syncfusion.Blazor.Data;
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication;
@using Microsoft.EntityFrameworkCore 
@using SuperCodeData;

@inherits DataAdaptor;

@inject SuperCodeClient Client;

<CascadingValue Value="@this">
    @ChildContent
</CascadingValue>

@code {
    [Parameter]
    public RenderFragment ChildContent { get; set; }

    [Parameter]
    public string ErrorMessage {get; set; }

    List<User> Users = new List<User>();

    public override async Task<object> ReadAsync(DataManagerRequest dataManagerRequest, string key = null)
    {
        try
        {
            using var context = await Client.GetDbContextAsync();
            Users = await context.Users.ToListAsync();
        }
        catch (AccessTokenNotAvailableException aex)
        {
            // authenticate
            aex.Redirect();
        }
        catch (Exception ex)
        {
            ErrorMessage = ex.Message;
        }

        return new DataResult() {Result = Users};
    } 
}