@using AzureBlazorCosmosWasm.Data
@using Syncfusion.Blazor.Data
@using SuperCodeData

@inject SuperCodeClient Client
 

<h1>Users</h1>
<h2>SyncFusion</h2>
<SfGrid TValue="User" AllowPaging="true" Toolbar="@(new List<string>() { "Add", "Edit", "Delete", "Cancel", "Update" })">
    <SfDataManager Adaptor="Adaptors.CustomAdaptor">
    <EFCoreCosmosAdaptor />
    </SfDataManager>
  <GridPageSettings PageSize="20"/>
  <GridEditSettings AllowAdding="true" AllowEditing="true" AllowDeleting="true"></GridEditSettings>
  <GridColumns>
    <GridColumn Field="@nameof(User.FirstName)"/>
    <GridColumn Field="@nameof(User.LastName)"/>
  </GridColumns>
</SfGrid>

@code {
    [Parameter]
    public List<User> Users { get; set; }

    static User UpdateItem(User item, Dictionary<string, object> itemProperties) {
      foreach (var field in itemProperties.Keys) {
        switch (field) {
          case "FirstName":
            item.FirstName = (string)itemProperties[nameof(User.FirstName)];
            break;
          case "LastName":
            item.LastName = (string)itemProperties[nameof(User.LastName)];
            break;
        }
      }
      return item;
    }

    protected async void OnRowInserting(Dictionary<string, object> itemProperties) {
      User newUser = UpdateItem(new User(), itemProperties);
      Users.Add(newUser);
      using (var context = await Client.GetDbContextAsync())
      {
        context.Users.Add(newUser);
        await context.SaveChangesAsync();
      }
    }
}
